<!DOCTYPE html>
<html>

<head>
  <title>Results</title>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

  <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>

  <link rel="stylesheet" type="text/css" src="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css" />

  <link rel="stylesheet" type="text/css" href="stylesheets/loader.css" />
  <!-- <link rel="stylesheet" type="text/css" href="stylesheets/table.css" /> -->
  <link rel="stylesheet" type="text/css" href="stylesheets/upload.css" />

  <script src="javascripts/chunkList.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"
    integrity="sha256-t9UJPrESBeG2ojKTIcFLPGF7nHi2vEc7f5A2KpH/UBU=" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.0/css/buttons.bootstrap4.min.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">

  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css">

  <link src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js">
  </script>

  <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>

  <script src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>

  <script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.bootstrap4.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

  <script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.html5.min.js"></script>

  <script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.print.min.js"></script>

  <script src="https://cdn.datatables.net/buttons/1.7.0/js/buttons.colVis.min.js"></script>

</head>

<body>

  <h1 style="text-align: center; margin-top: 20px; margin-bottom: 0;">النتائج</h1>
  <div class="container">
    <% if (contents) { %>
      <div id="wordCount" style="text-align: end;">
        <%= contents['wordCount'] %> :عدد الكلمات
      </div>

      <div id="uniqueWordCount" style="text-align: end;">
        <%= contents['uniqueWordCount'] %> :عدد الكلمات المميزة
      </div>

      <div id="similarity" style="text-align: end;">
        %<%= contents['truePercentage'] %> :نسبة التشابه بين قائمتك والقائمة المختارة
      </div>

      <script>
        var commonList = "<%= contents['commonList'] %>";
        commonList = commonList.split(',');
        const common = commonList.chunk(1);
        console.log(common);
        $('#document').ready(function () {
          var table = $('#similarityTable').DataTable(
            {
              buttons: ['copy', 'excel', 'pdf', 'colvis'],
              lengthChange: false,
              dom: 'Blfrtip',
              data: common,
              columns: [
                { title: "الكلمات المشتركة" },
              ],
              initComplete: function () {
                table.buttons().container().appendTo('#similarityTable_wrapper .col-md-6:eq(0)');
                $("#myDynamicTable").show();
              },
              scrollY: "200px",
              searching: true,
              scrollCollapse: true,

              language: {
                url: 'http://cdn.datatables.net/plug-ins/1.10.24/i18n/Arabic.json',
              },
              aoColumns: [{ bSearchable: true, bSortable: false }],
            });
          table.buttons().container()
            .appendTo($('.col-md-6:eq(0)', table.table().container()));

        });
      </script>

      <table id="similarityTable" class="table table-striped table-bordered" width="100%"></table>


      <script>
        var unCommonList = "<%= contents['unCommonList'] %>";
        var splitUnCommon = unCommonList.split(",");
        const unCommon = splitUnCommon.chunk(2);
        console.log(unCommon);
        $('#document').ready(function () {
          var table = $('#unSimilarityTable').DataTable(
            {
              buttons: ['copy', 'excel', 'pdf', 'colvis'],
              lengthChange: false,
              dom: 'Blfrtip',
              data: unCommon,
              columns: [
                { title: "ترددها" },
                { title: "الكلمات غير المشتركة" },
              ],
              initComplete: function () {
                table.buttons().container().appendTo('#unSimilarityTable_wrapper .col-md-6:eq(0)');
                $("#unSimilarityTable").show();
              },
              scrollY: "200px",
              searching: true,
              scrollCollapse: true,
              order: [[0, "desc"]],
              language: {
                url: 'http://cdn.datatables.net/plug-ins/1.10.24/i18n/Arabic.json',
              },
              aoColumns: [{ bSearchable: true, bSortable: false }],
            });
          table.buttons().container()
            .appendTo($('.col-md-6:eq(0)', table.table().container()));

        });
      </script>

      <table id="unSimilarityTable" class="table table-striped table-bordered" width="100%"></table>

      <form id="form">
        <div class="input-group">
          <div style="width: fit-content;">
            <span style="display:inline;">
              <script>
                const occurrenceString = "<%= contents['occurrenceList'] %>";
                const occurrenceList = occurrenceString.split(',');
                console.log(occurrenceList.chunk(2).length);
                $('#document').ready(function () {
                  var table = $('#myDynamicTable').DataTable(
                    {
                      buttons: ['copy', 'excel', 'pdf', 'colvis'],
                      lengthChange: false,
                      dom: 'Blfrtip',
                      data: occurrenceList.chunk(2),
                      columns: [
                        { title: "ترددها" },
                        { title: "الكلمات" },
                      ],
                      order: [[0, "desc"]],
                      initComplete: function () {
                        table.buttons().container().appendTo('#myDynamicTable_wrapper .col-md-6:eq(0)');
                        $("#myDynamicTable").show();
                      },
                      scrollY: "200px",
                      searching: true,
                      scrollCollapse: true,

                      language: {
                        url: 'http://cdn.datatables.net/plug-ins/1.10.24/i18n/Arabic.json',
                      },
                      aoColumns: [{ bSearchable: true, bSortable: true }],
                    });
                  table.buttons().container()
                    .appendTo($('.col-md-6:eq(0)', table.table().container()));

                });
              </script>
          </div>
      </form>
  </div>


  <table id="myDynamicTable" class="table table-striped table-bordered" width="100%"></table>


  </div>

  <canvas id="myChart"></canvas>

  </div>
  <% } %>


    <script>

      function getCol(matrix, col) {
        var column = [];
        for (var i = 0; i < matrix.length; i++) {
          column.push(matrix[i][col]);
        }
        return column;
      }

      var ctx = document.getElementById('myChart').getContext('2d');
      var chart = new Chart(ctx, {
        // The type of chart we want to create
        type: 'bar',

        // The data for our dataset
        data: {
          labels: getCol(occurrenceList.chunk(2), 1),
          datasets: [{
            label: 'تردد الكلمات',
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            data: getCol(occurrenceList.chunk(2), 0)
          }]
        },

        // Configuration options go here
        options: {}
      });
    </script>

    <div class="loader-wrapper">
      <span class="loader"><span class="loader-inner"></span></span>
    </div>

    <script>
      $(window).on("load", function () {
        $(".loader-wrapper").fadeOut("fast");
      });
    </script>


</body>

</html>